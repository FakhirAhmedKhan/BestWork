import{r,j as s,m as l}from"./index-CcqloXzJ.js";import{a as N}from"./index-ngrFHoWO.js";function S({show:j}){const[u,x]=r.useState([]),[n,c]=r.useState([]),[d,h]=r.useState(""),[f,g]=r.useState(!1),p=r.useRef(null),m=r.useRef(new Map),y=r.useMemo(()=>u.map(({question:e,answer:a},t)=>`Q${t+1}: ${e}
A${t+1}: ${a}`).join(`

`),[u]);r.useEffect(()=>{const e=localStorage.getItem("trainingData");e?x(JSON.parse(e)):N.get("https://raw.githubusercontent.com/FakhirAhmedKhan/DataApi-main/refs/heads/main/Data/trainingData.json").then(a=>{const t=a.data.trainingData||[];x(t),localStorage.setItem("trainingData",JSON.stringify(t))}).catch(a=>console.error("Error fetching Data:",a))},[]),r.useEffect(()=>{p.current?.scrollTo({top:p.current.scrollHeight,behavior:"smooth"})},[n,f]);const b=r.useCallback(async(e,a)=>{if(e.length){if(m.current.has(a)){const t=m.current.get(a);c(o=>[...o,{role:"model",text:t}]);return}g(!0);try{const t=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDxNRzdeVtQEKv5r5R_BAhmPLm296ysAcg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[...y?[{role:"user",parts:[{text:y}]}]:[],...e.map(({role:i,text:k})=>({role:i,parts:[{text:k}]}))]})});if(!t.ok){const i=await t.json();console.error("API Error:",i),g(!1);return}const o=(await t.json())?.candidates?.[0]?.content?.parts?.[0]?.text?.replace(/<[^>]+>/g,"").trim();o&&(m.current.set(a,o),c(i=>[...i,{role:"model",text:o}]))}catch(t){console.error("Bot response error:",t)}finally{g(!1)}}},[y]),w=r.useCallback(async e=>{e.preventDefault();const a=d.trim();if(!a)return;const t=[...n,{role:"user",text:a}];c(t),h(""),await b(t,a)},[d,n,b]);return j?s.jsxs(l.section,{className:"fixed bottom-6 right-6 w-80 md:w-96 h-[500px] rounded-2xl shadow-2xl bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 flex flex-col",initial:{opacity:0,scale:.8,y:40},animate:{opacity:1,scale:1,y:0},transition:{type:"spring",stiffness:120,damping:15},children:[s.jsxs("div",{ref:p,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[n.length===0&&s.jsx(l.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},className:"flex items-start gap-2",children:s.jsx("span",{className:"px-4 py-2 rounded-xl bg-indigo-100 text-indigo-800 dark:bg-indigo-800 dark:text-indigo-100 shadow-sm",children:"ðŸ¤– Hi there! Welcome to my portfolio. How may I assist you today?"})}),n.map((e,a)=>s.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:`flex ${e.role==="user"?"justify-end":"justify-start"}`,children:s.jsx("div",{className:`px-4 py-2 max-w-[75%] rounded-xl shadow-sm ${e.role==="user"?"bg-indigo-500 text-white rounded-br-none":"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded-bl-none"}`,children:e.text})},a)),f&&s.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-start gap-2",children:s.jsx("span",{className:"px-4 py-2 rounded-xl bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-sm animate-pulse",children:"ðŸ¤– Bot is typing..."})})]}),s.jsx("form",{onSubmit:w,className:"p-3 border-t border-gray-200 dark:border-gray-700 flex items-center gap-2",children:s.jsx("input",{type:"text",placeholder:"Type a message...",value:d,onChange:e=>h(e.target.value),className:"flex-1 px-4 py-2 rounded-xl","aria-label":"Type your message"})})]}):null}export{S as default};
